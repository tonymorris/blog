<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
  <title>λ Tony's blog λ - Nothing returns anything, ever!</title>
  <link href="http://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet" type="text/css" />
  <link rel="stylesheet" type="text/css" href="../../css/screen.css" />
  <link rel="stylesheet" type="text/css" href="../../css/syntax.css" />
  <link rel="alternate" type="application/atom+xml" href="http://blog.tmorris.net/atom.xml" title="Atom feed" />
  <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
  <script type="text/javascript" src="https://raw.github.com/Mathapedia/LaTeX2HTML5/master/latex2html5.min.js"></script>
</head>
<body>
<div id="title">
  λ Tony's blog λ
  <div id="subtitle">
    The weblog of Tony Morris
  </div>
</div>
<div id="header">
  <div id="navigation">
    <a class="navbar" href="../../index.html">Home</a>
    <a class="navbar" href="../../posts/">All Posts</a>
    <a class="navbar" href="../../contact/">Contact</a>
    <a class="navbar" href="http://cv.tmorris.net/">CV</a>
    <a class="navbar" href="../../atom.xml"><img src="../../images/feed-icon-14x14.png" alt="feed" /></a>
  </div>
</div>
<h1>Nothing returns anything, ever!</h1>
<div class="info">Posted on December 28, 2010, in <a href="../../tags/Programming/index.html">Programming</a></div>

<p>I once had the following discussion with someone regarding a Java project:</p>
<blockquote>
<p>Him: Once we did a project and we didn’t return anything from a method, ever (i.e. <code>void</code>) It went very well. Me: So everything was in CPS transform then so that you could simulate it? Him: No, we didn’t ever return anything ever! Me: So uh, it was uh, in CPS transform then, since er… you know… Him: No! Nothing. Return. Nothing. Ever. Void. Always! Me: Er yeah right uh huh.</p>
</blockquote>
<p>This person operates under the illusion that I am in an intellectual battle with him, so I can excuse the somewhat awkward discussion. My efforts to destroy this destructive illusion have been repeated failure to date. That’s a side-story.</p>
<p>It occurred to me later, thanks to Edward Kmett, that perhaps it wasn’t a CPS transform but using exceptions instead! I doubt that was the case :) I’m also reasonably confident this discussion was <em>argumentum ad ignorantiam</em> – my converser doesn’t know what CPS transform means (so it can’t possibly be true!), but that’s cool – let’s not dwell on it. Instead, let’s have a look how you can simulate returning a value without actually returning a value using continuation-passing style (CPS)!</p>
<p>We may conjure up both simple and elaborate examples of functions that actually return a value:</p>
<div class="sourceCode"><pre class="sourceCode Java"><code class="sourceCode java">Integer <span class="fu">wibble</span>(String s, <span class="dt">double</span> d)
Swizzler <span class="fu">function1</span>(<span class="dt">int</span> i, String s, Swazzle z)</code></pre></div>
<p>I am going to use the trivial example (top one), but I hope you’ll be able to extrapolate to swizzlier cases.</p>
<p>First, note that Java methods may perform side-effects willy-nilly. Passing in a <code>String</code> and a <code>double</code> are not the only values that the function may access. The function may print to standard output, use variables in any scope, read/write files, the network and so on. This changes things a little (read: a lot) with regard to how we look at a function, so perhaps this is why this technique has apparent (read: apparent) merit.</p>
<p>Suppose a very simple interface:</p>
<div class="sourceCode"><pre class="sourceCode Java"><code class="sourceCode java"><span class="kw">interface</span> To&lt;a&gt; {
  <span class="dt">void</span> <span class="fu">to</span>(A a);
}</code></pre></div>
<p>Quite simply, this function takes a polymorphic (aka generic) value and performs a side-effect, perhaps using this value. It is important to point out that this polymorphic interface may be modelled differently e.g. it may not be polymorphic:</p>
<div class="sourceCode"><pre class="sourceCode Java"><code class="sourceCode java"><span class="kw">interface</span> Stringer {
  <span class="dt">void</span> <span class="fu">stringer</span>(String s);
}</code></pre></div>
<p>This interface is exactly equivalent to <code>To&lt;String&gt;</code> so I’m also trusting that you’ll extrapolate my generic example to other possibilities.</p>
<p>Now, instead of returning a type e.g. <code>Integer</code> in the <code>wibble</code> function, we may return <code>void</code> with an additional <code>To&lt;Integer&gt;</code> argument. We can do this for every single function that would otherwise return a value!</p>
<p>How does that work then? Simple really. We compute the <code>Integer</code> as we normally would in the body of <code>wibble</code> and instead of returning it (we can’t of course), we pass it to the <code>to</code> method of the given <code>To&lt;Integer&gt;</code> instance.</p>
<div class="sourceCode"><pre class="sourceCode Java"><code class="sourceCode java"><span class="dt">void</span> <span class="fu">wibble</span>(String s, <span class="dt">double</span> d, To&lt;integer&gt; t)</code></pre></div>
<p>And so on it goes, for every method.</p>
<p>Essentially, this results in a function that, instead of returning a value of type T, returns a value of the type <code>(T =&gt; void) =&gt; void</code> where <code>(T =&gt; void)</code> is represented by the <code>To</code> interface and is of course, in the position of a method argument where that method returns <code>void</code>. This is exactly equivalent to a specific example of a continuation. We are doing a CPS transform to simulate returning a value!</p>
<p>To summarise the formula:</p>
<blockquote>
<p>For a method that would normally return a type T, we can transform it in such a way to accept an argument of type <code>To&lt;T&gt;</code> and returns void.</p>
</blockquote>
<p>As for the merits of doing this, well I’ll leave that for another battle :) Further, there are some interesting properties about continuations, in particular, <a href="http://blog.tmorris.net/continuation-monad-in-scala/">they are a monad</a>, perhaps even <a href="http://blog.sigfpe.com/2008/12/mother-of-all-monads.html">the mother of all monads</a>, but we’ll leave all that for another day too.</p>
<p>Edit: Per comments, I think a clarification is in order. Doing this is a <strong>very very bad idea</strong> on the JVM (without tail-call elimination – note that the IBM implementation only does direct TCE). Doing this results in a significant performance degradation and increased syntax <strong>for zero benefit</strong>. I didn’t bring this up because I was never going to get that far in the original conversation that I mention. <strong>Beware.</strong></p>


<hr />
<div id="disqus_thread"></div>
<script type="text/javascript">
  var disqus_shortname = 'tonys--blog';
  var discus_identifier = '/posts/nothing-returns-anything-ever/index.html';
  var disqus_url = 'http://blog.tmorris.net/posts/nothing-returns-anything-ever/index.html';
  var discus_title = 'Nothing returns anything, ever!';
  (function () {
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>
<noscript><p>The comments use <a href="http://disqus.com/?ref_noscript">Disqus</a>,
  which requires Javascript.</p></noscript>

<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-3405112-1']);
  _gaq.push(['_trackPageview']);
  (function () {
    var ga = document.createElement('script');
    ga.type = 'text/javascript';
    ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(ga, s);
  })();
</script>
</body>
</html>
